# GitHub Actions Workflow for AWS CDK Deployment

This GitHub Actions workflow automates the deployment of an AWS CDK stack whenever changes are pushed to the main branch of your GitHub repository. Below is an explanation of each step in the workflow:

## Workflow Breakdown

### **1. Trigger the Workflow**

```yml
on:
  push:
    branches:
      - main  # Trigger the workflow on push to the main branch

```
- This section defines the event that will trigger the workflow. In this case, the workflow is triggered every time a push is made to the `main` branch. You can customize this to trigger on different branches or events (e.g., pull requests) as needed.


### **2. Define the Job**

```yml
jobs:
  deploy:
    runs-on: ubuntu-latest  # Use the latest Ubuntu runner for the job

```

- This section defines the job called `deploy`. The job will run on the ``ubuntu-latest`` environment, which is the most commonly used runner in GitHub Actions and provides an Ubuntu-based environment to run commands.


### **3. Checkout Code**

```yml
- name: Checkout code
  uses: actions/checkout@v4  # Checkout the code in the repository

```

- The `actions/checkout` step fetches the repository code to the GitHub Actions runner so that it can be used in subsequent steps.
- `actions/checkout@v4` ensures that the latest code from the repository is checked out.


### **4. Set Up Node.js**


```yml
- name: Set up Node.js
  uses: actions/setup-node@v4
  with:
    node-version: '18'  # Set the Node.js version to match your CDK project version

```

- This step sets up the Node.js environment on the runner, ensuring that Node.js version `18` is installed.
- This is necessary to run npm commands for installing dependencies, compiling TypeScript, and executing CDK commands.


### 5. Install Dependencies


```yml
- name: Install dependencies
  run: |
    npm install  
    npm install -g aws-cdk

```

- This step installs all dependencies specified in the `package.json` file using `npm install`.
- It also installs the AWS CDK globally using `npm install -g aws-cdk`, so that the `cdk` command can be run directly in subsequent steps


### 6. Compile TypeScript Code

```yml
- name: Compile TypeScript code
  run: |
    npm run build

```

- This step compiles the TypeScript code in your project using the `npm run build` command.
- Make sure your` package.json` has a build script that compiles the TypeScript code. For example:

```json
"scripts": {
  "build": "tsc"
}
```


- This step ensures that all your TypeScript files are compiled into JavaScript before deploying them to AWS.


### **7. Generate the CloudFormation Template**


```yml
- name: Synth CDK
  run: |
    cdk synth

```


- This step runs the `cdk synth` command, which synthesizes your AWS CDK application and generates a CloudFormation template.
- The CloudFormation template represents the infrastructure defined in your CDK app and is used for deployment to AWS.


### **8. Configure AWS Credentials**


```yml
- name: Configure AWS credentials
  uses: aws-actions/configure-aws-credentials@v1
  with:
    aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}  # Use GitHub secrets for AWS access key
    aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}  # Use GitHub secrets for AWS secret key
    aws-region: 'us-east-1'  # Set the AWS region for deployment (change as necessary)

```


- This step configures AWS credentials using GitHub Secrets. It uses the `aws-actions/configure-aws-credentials` action to securely provide the AWS access key and secret key to the runner.
- The credentials stored as secrets (`AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY`) are used for authentication when deploying resources to AWS.
- The `aws-region` is set to `us-east-1,` but you can modify this to your preferred region.



### **9. Deploy the AWS CDK Stack**


```yml
- name: Deploy AWS CDK Stack
  run: |
    cdk deploy

```


- This final step runs the `cdk deploy` command, which deploys the CloudFormation template generated by `cdk synth` to AWS.
- The `cdk deploy` command provisions the infrastructure defined in your CDK app on AWS.
- Note that `cdk deploy` deploys the stack without requiring manual approval due to the absence of the `--require-approval` flag, which would normally ask for approval before deploying certain changes (like IAM changes or changes that affect resources).


## Summary of the Workflow:

- **Trigger**: The workflow is triggered on every push to the `main` branch.
- **Job Execution**: The workflow runs on an Ubuntu environment.

### Steps:

1. **Checkout code**: Fetches the latest repository code.
2. **Set up Node.js**: Prepares Node.js version 18 for executing CDK commands.
3. **Install dependencies**: Installs the necessary dependencies, including AWS CDK.
4. **Compile TypeScript**: Compiles TypeScript code into JavaScript.
5. **Synthesize CloudFormation template**: Generates the CloudFormation template.
6. **Configure AWS credentials**: Configures AWS credentials for deployment.
7. **Deploy CDK stack**: Deploys the generated CloudFormation stack to AWS.

